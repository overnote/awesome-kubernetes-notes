

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>二 核心组件/附件 &mdash; Zeusro&#39;s awesome-kubernetes-notes 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="三 集群部署" href="chapter_3.html" />
    <link rel="prev" title="一 Kubernetes概述" href="chapter_1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Zeusro's awesome-kubernetes-notes
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="chapter_0.html">关于“我”</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_1.html">一 Kubernetes概述</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">二 核心组件/附件</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#controller">2.1 Controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">杀容器的过程</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#service">2.2 Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">2.3 其他常用资源</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">2.4 网络模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kube-proxy">2.5 kube-proxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#etcd">2.6 etcd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flanel">2.7 flanel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">知识小结</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="chapter_3.html">三 集群部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_4.html">四 入门命令</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_5.html">五 配置清单使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_6.html">六 集群故障管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html">七 控制器配置清单</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#service">八 Service 配置清单</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#ingress">九 ingress 控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#pod">十 POD 存储卷</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id25">十一 配置信息容器化</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#statefulset">十二 StatefulSet 控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id33">十三 用户认证系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id40">十四 用户权限系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#dashboard">十五 dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id46">十六 网络通信</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id55">十七 调度策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id62">十八 高级调度设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id68">十九 容器资源限制</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#heapster">二十 HeapSter监控（废弃中）</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id71">二十一 新一代监控架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#id75">二十二 K8S包管理器</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#etcd">二十三 ETCD详解</a></li>
<li class="toctree-l1"><a class="reference internal" href="awesome-kubernetes-notes.html#kubesphere">二十四 国产容器管理平台KubeSphere实战排错</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Zeusro's awesome-kubernetes-notes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>二 核心组件/附件</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/chapter_2.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>二 核心组件/附件<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="controller">
<h2>2.1 Controller<a class="headerlink" href="#controller" title="Permalink to this headline">¶</a></h2>
<p>controller manager 是只运行在 master 节点上面的特殊容器</p>
<p>Examples of controllers that ship with Kubernetes today are the replication controller, endpoints controller, namespace controller, and serviceaccounts controller.</p>
<p>这些控制器分别用于确保不同类型的 POD 资源运行于符合用户所期望的状态。</p>
<ul class="simple">
<li><p>RelicationController</p></li>
</ul>
<p>控制同一类 POD 对象的副本数量，实现程序的滚动更新，或者回滚的操作。</p>
<p>在滚动更新时候，允许临时超出规定的副本数量，</p>
<ul class="simple">
<li><p>Node Controller</p></li>
</ul>
<p>Responsible for noticing and responding when nodes go down</p>
<ul class="simple">
<li><p>Endpoints Controller</p></li>
</ul>
<p>Populates the Endpoints object (that is, joins Services &amp; Pods)</p>
<ul class="simple">
<li><p>Service Account &amp; Token Controllers</p></li>
</ul>
<p>Create default accounts and API access tokens for new namespaces</p>
<p>参考链接：
<a class="reference external" href="https://kubernetes.io/docs/concepts/overview/components/">Kubernetes组件</a></p>
<div class="section" id="id2">
<h3>杀容器的过程<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// killContainer kills a container through the following steps:</span>
<span class="c1">// * Run the pre-stop lifecycle hooks (if applicable).</span>
<span class="c1">// * Stop the container.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">kubeGenericRuntimeManager</span><span class="p">)</span> <span class="nx">killContainer</span><span class="p">(</span><span class="nx">pod</span> <span class="o">*</span><span class="nx">v1</span><span class="p">.</span><span class="nx">Pod</span><span class="p">,</span> <span class="nx">containerID</span> <span class="nx">kubecontainer</span><span class="p">.</span><span class="nx">ContainerID</span><span class="p">,</span> <span class="nx">containerName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">message</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">gracePeriodOverride</span> <span class="o">*</span><span class="kt">int64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">containerSpec</span> <span class="o">*</span><span class="nx">v1</span><span class="p">.</span><span class="nx">Container</span>
	<span class="k">if</span> <span class="nx">pod</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">containerSpec</span> <span class="p">=</span> <span class="nx">kubecontainer</span><span class="p">.</span><span class="nx">GetContainerSpec</span><span class="p">(</span><span class="nx">pod</span><span class="p">,</span> <span class="nx">containerName</span><span class="p">);</span> <span class="nx">containerSpec</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get containerSpec %q(id=%q) in pod %q when killing container for reason %q&quot;</span><span class="p">,</span>
				<span class="nx">containerName</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span> <span class="nx">format</span><span class="p">.</span><span class="nx">Pod</span><span class="p">(</span><span class="nx">pod</span><span class="p">),</span> <span class="nx">message</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// Restore necessary information if one of the specs is nil.</span>
		<span class="nx">restoredPod</span><span class="p">,</span> <span class="nx">restoredContainer</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">restoreSpecsFromContainerLabels</span><span class="p">(</span><span class="nx">containerID</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">err</span>
		<span class="p">}</span>
		<span class="nx">pod</span><span class="p">,</span> <span class="nx">containerSpec</span> <span class="p">=</span> <span class="nx">restoredPod</span><span class="p">,</span> <span class="nx">restoredContainer</span>
	<span class="p">}</span>

	<span class="c1">// From this point, pod and container must be non-nil.</span>
	<span class="nx">gracePeriod</span> <span class="o">:=</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">minimumGracePeriodInSeconds</span><span class="p">)</span>
	<span class="k">switch</span> <span class="p">{</span>
	<span class="k">case</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">DeletionGracePeriodSeconds</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">:</span>
		<span class="nx">gracePeriod</span> <span class="p">=</span> <span class="o">*</span><span class="nx">pod</span><span class="p">.</span><span class="nx">DeletionGracePeriodSeconds</span>
	<span class="k">case</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">TerminationGracePeriodSeconds</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">:</span>
		<span class="nx">gracePeriod</span> <span class="p">=</span> <span class="o">*</span><span class="nx">pod</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">TerminationGracePeriodSeconds</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">message</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Stopping container %s&quot;</span><span class="p">,</span> <span class="nx">containerSpec</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">m</span><span class="p">.</span><span class="nx">recordContainerEvent</span><span class="p">(</span><span class="nx">pod</span><span class="p">,</span> <span class="nx">containerSpec</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">EventTypeNormal</span><span class="p">,</span> <span class="nx">events</span><span class="p">.</span><span class="nx">KillingContainer</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>

	<span class="c1">// Run internal pre-stop lifecycle hook</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">internalLifecycle</span><span class="p">.</span><span class="nx">PreStopContainer</span><span class="p">(</span><span class="nx">containerID</span><span class="p">.</span><span class="nx">ID</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="c1">// Run the pre-stop lifecycle hooks if applicable and if there is enough time to run it</span>
	<span class="k">if</span> <span class="nx">containerSpec</span><span class="p">.</span><span class="nx">Lifecycle</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">containerSpec</span><span class="p">.</span><span class="nx">Lifecycle</span><span class="p">.</span><span class="nx">PreStop</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">gracePeriod</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">gracePeriod</span> <span class="p">=</span> <span class="nx">gracePeriod</span> <span class="o">-</span> <span class="nx">m</span><span class="p">.</span><span class="nx">executePreStopHook</span><span class="p">(</span><span class="nx">pod</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">,</span> <span class="nx">containerSpec</span><span class="p">,</span> <span class="nx">gracePeriod</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c1">// always give containers a minimal shutdown window to avoid unnecessary SIGKILLs</span>
	<span class="k">if</span> <span class="nx">gracePeriod</span> <span class="p">&lt;</span> <span class="nx">minimumGracePeriodInSeconds</span> <span class="p">{</span>
		<span class="nx">gracePeriod</span> <span class="p">=</span> <span class="nx">minimumGracePeriodInSeconds</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">gracePeriodOverride</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">gracePeriod</span> <span class="p">=</span> <span class="o">*</span><span class="nx">gracePeriodOverride</span>
		<span class="nx">klog</span><span class="p">.</span><span class="nx">V</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">Infof</span><span class="p">(</span><span class="s">&quot;Killing container %q, but using %d second grace period override&quot;</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">,</span> <span class="nx">gracePeriod</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">klog</span><span class="p">.</span><span class="nx">V</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">Infof</span><span class="p">(</span><span class="s">&quot;Killing container %q with %d second grace period&quot;</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span> <span class="nx">gracePeriod</span><span class="p">)</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">runtimeService</span><span class="p">.</span><span class="nx">StopContainer</span><span class="p">(</span><span class="nx">containerID</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">gracePeriod</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">klog</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Container %q termination failed with gracePeriod %d: %v&quot;</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span> <span class="nx">gracePeriod</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">klog</span><span class="p">.</span><span class="nx">V</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">Infof</span><span class="p">(</span><span class="s">&quot;Container %q exited normally&quot;</span><span class="p">,</span> <span class="nx">containerID</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
	<span class="p">}</span>

	<span class="nx">m</span><span class="p">.</span><span class="nx">containerRefManager</span><span class="p">.</span><span class="nx">ClearRef</span><span class="p">(</span><span class="nx">containerID</span><span class="p">)</span>

	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="service">
<h2>2.2 Service<a class="headerlink" href="#service" title="Permalink to this headline">¶</a></h2>
<p>为客户端提供一个稳定的访问入口，Service 靠标签选择器来关联 POD 的，只要
POD 上有相关的标签，那么就会被 Service 选中，作为 Service
的后端，Service 关联 POD 后会动态探测这个 POD 的 IP
地址和端口，并作为自己调度的后端。</p>
<p>总的来说客户端请求 Service 由 Service 代理至后端的
POD，所以客户端看到的始终是 Service 的地址。</p>
<p>K8S 上的 Service 不是一个应用程序，也不是一个组件，它是一个 iptables
dnat 规则，或者 ipvs 规则，Service 只是规则，所以是 ping
不通的，由于是dnat规则或是ipvs规则，可以使用利用端口进行测试</p>
<p>Service 作为 k8s 的对象来说，是有名称的，可以通过 Service 的名称解析为
Service 的 IP 地址</p>
<p>一般格式: <code class="docutils literal notranslate"><span class="pre">svcname.namespace.svc.cluster.local</span></code>, 如果在同一个 namespace
中可以直接使用 svcname , 如果不在同一个 namespace 中,
需要写完整的FQDN域名。</p>
<ul class="simple">
<li><p>AddOns</p></li>
</ul>
<p>解析域名是由 DNS 来解析的，为 k8s
中提供域名解析这种基础服务，称之为基础架构 POD 也称为 k8s
附件，所以域名解析的 POD 就是 k8s 中的一种 AddOns。</p>
<p>而 k8s 中的 dns 附件，是动态的，例如：service 名称发生更改，就会自动触发
dns 中的解析记录的改变，如果手动修改 service 的地址，也会自动触发 DNS
解析记录的改变，所以客户端访问服务时，可以直接访问服务的名称。</p>
</div>
<div class="section" id="id3">
<h2>2.3 其他常用资源<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>RelicaSet</p></li>
</ul>
<p>副本集控制器，它不直接使用，它有一个声明式中心控制器 Deployment</p>
<ul class="simple">
<li><p>Deployment</p></li>
</ul>
<p>它只能管理无状态的应用，这个控制器，支持二级控制器，例如：HPA（Horizontal
Pod Autoscaler，水平 POD
自动伸缩控制器），当负载高的时候，自动启动更多的 POD。</p>
<ul class="simple">
<li><p>StatefulSet</p></li>
</ul>
<p>管理有状态的应用</p>
<ul class="simple">
<li><p>DaemonSet</p></li>
</ul>
<p>如果需要在每一个 node 上运行一个副本，而不是随意运行</p>
<ul class="simple">
<li><p>Job</p></li>
</ul>
<p>运行一次性作业，时间不固定的操作，例如：备份、清理，临时启动一个 POD
来进行备份的任务，运行完成就结束了。</p>
<p>如果运行时候 JOB
挂了，那么需要重新启动起来，如果运行完成了则不需要再启动了。</p>
<ul class="simple">
<li><p>Cronjob</p></li>
</ul>
<p>运行周期性作业</p>
</div>
<div class="section" id="id4">
<h2>2.4 网络模型<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>k8s 有三种网络：POD网络、集群网络、节点网络</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>POD网络：所有 POD 处于同一个网络中，叠加网络
集群网络：Service 是一个另外一个网络
节点网络：node 节点也是另外一个网络，宿主机的内网网络
</pre></div>
</div>
<p>所以，接入外部访问时候，请求首先到达 node 网络，然后 node 网络代理至
service 网络，service 根据 iptables/ipvs 规则来转发到 pod 网络中的 pod
上。 ~~~ NODE 网络 -&gt; SVC 网络 -&gt; POD 网络 ~~~</p>
<p>k8s 有三种通信：</p>
<ul class="simple">
<li><p>同一个 POD 内的多个容器间的通信，可以通过 lo 通信直接通讯。</p></li>
<li><p>POD 与 POD 通信，如果使用 flannel 所有 POD 都处于一个网络，可以跨
node 与另外的 POD 直接通信，因为使用了叠加网络。</p></li>
<li><p>POD 与 Service 通信。</p></li>
</ul>
</div>
<div class="section" id="kube-proxy">
<h2>2.5 kube-proxy<a class="headerlink" href="#kube-proxy" title="Permalink to this headline">¶</a></h2>
<p>在 node 节点上运行的一个守护进程，它负责随时与 apiserver
进行通信，因为每个 pod 发生变化后需要保存在 apiserver 中，而 apiserver
发生改变后会生成一个通知事件，这个事件可以被任何关联的组件接收到，例如被
kube-proxy 一旦发现某个 service 后端的 pod 地址发生改变，那么就由
kube-proxy 负责在本地将地址写入 iptables 或者 ipvs 规则中。</p>
<p>所以 service 的管理是靠 kube-proxy 来实现的，当你创建一个 service
，那么就靠 kube-proxy 在每个节点上创建为 iptables 或者 ipvs 规则，每个
service 的变动也需要 kube-proxy 反应到规则上。</p>
<p>apiserver 需要保存各个 node 信息，它需要保存在 etcd 中。</p>
</div>
<div class="section" id="etcd">
<h2>2.6 etcd<a class="headerlink" href="#etcd" title="Permalink to this headline">¶</a></h2>
<p>是一个键值存储的系统，与 redis 很像，但是 etcd 还有一些协调功能是 redis
所不具备的，它还有节点选举等功能，从这个角度来讲 etcd 更像 zookeeper。</p>
<p>由于整个集群的所有信息都保存在 etcd，所以 etcd
如果宕机，那么整个集群就挂了，因而 etcd 需要做高可用。</p>
</div>
<div class="section" id="flanel">
<h2>2.7 flanel<a class="headerlink" href="#flanel" title="Permalink to this headline">¶</a></h2>
<p>托管为 k8s 的附件运行, 在 k8s 中有很多其他的开源网络插件，例如高性能的
calico 三层网络插件,性能很好，支持访问控制</p>
<p>node 网络：物理各节点之间进行通信</p>
<p>POD 网络：所有 node上的 POD 彼此之间通过叠加，或者直接路由方式通信</p>
<p>service 网络：由 kube-proxy 负责管控和生成</p>
</div>
<div class="section" id="id5">
<h2>知识小结<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p><img alt="_images/components-of-kubernetes.png" src="_images/components-of-kubernetes.png" /></p>
<ul class="simple">
<li><p>Master</p></li>
</ul>
<div class="highlight-{=html} notranslate"><div class="highlight"><pre><span></span>&lt;!-- --&gt;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span>             <span class="c1"># 调度 pod</span>
<span class="n">kuber</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span>   <span class="c1"># 管理 pod</span>
<span class="n">kube</span><span class="o">-</span><span class="n">apiserver</span>             <span class="c1"># 接收请求</span>
<span class="n">etcd</span>                       <span class="c1"># 集群状态存储，集群所有的组件的状态都保存在这里</span>
</pre></div>
</div>
<ul class="simple">
<li><p>node</p></li>
</ul>
<div class="highlight-{=html} notranslate"><div class="highlight"><pre><span></span>&lt;!-- --&gt;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubelet</span>                    <span class="c1"># 节点/pod管理</span>
<span class="n">kube</span><span class="o">-</span><span class="n">proxy</span>                 <span class="c1"># watch apiserver管理service</span>
<span class="n">docker</span>                     <span class="c1"># 容器运行时</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chapter_3.html" class="btn btn-neutral float-right" title="三 集群部署" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chapter_1.html" class="btn btn-neutral float-left" title="一 Kubernetes概述" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, kaliarch,Zeusro

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>